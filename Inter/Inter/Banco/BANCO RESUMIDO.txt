CREATE DATABASE INTER;
USE INTER;

CREATE TABLE PER_PERFIL(
  PER_MATRICULA VARCHAR(20) PRIMARY KEY,
  PER_TIPO INT NOT NULL,
  PER_LOGIN VARCHAR(50),
  PER_SENHA VARCHAR(256)
);

CREATE TABLE SAN_SEMESTRE_ANO(
  SAN_CODIGO INT PRIMARY KEY AUTO_INCREMENT,
  SAN_ANO INT NOT NULL,
  SAN_SEMESTRE INT NOT NULL,
  SAN_ATIVO BOOL NOT NULL
);

CREATE TABLE PRI_PROJETO_INTER(
  PRI_CODIGO INT PRIMARY KEY AUTO_INCREMENT,
  SAN_CODIGO INT NOT NULL,
  PRI_DESCRICAO VARCHAR(200),
  PRI_EMENTA TEXT,
  FOREIGN KEY(SAN_CODIGO) REFERENCES SAN_SEMESTRE_ANO(SAN_CODIGO) ON UPDATE CASCADE ON DELETE NO ACTION
);

CREATE TABLE API_ATRIBUICAO_PI(
  PRI_CODIGO INT NOT NULL,
  ADI_CODIGO INT NOT NULL,
  API_MEDIA_DISCIPLINA DOUBLE,
  PRIMARY KEY(ADI_CODIGO, PRI_CODIGO),
  FOREIGN KEY(PRI_CODIGO) REFERENCES PRI_PROJETO_INTER(PRI_CODIGO) ON UPDATE CASCADE ON DELETE NO ACTION
);

CREATE TABLE EVE_EVENTOS(
  EVE_CODIGO INT PRIMARY KEY AUTO_INCREMENT,
  PRI_CODIGO INT NOT NULL,
  EVE_DATA DATE NOT NULL,
  EVE_TIPO VARCHAR(100),
  FOREIGN KEY(PRI_CODIGO) REFERENCES PRI_PROJETO_INTER(PRI_CODIGO) ON UPDATE CASCADE ON DELETE NO ACTION
);

CREATE TABLE GRU_GRUPO(
  GRU_CODIGO INT PRIMARY KEY AUTO_INCREMENT,
  PRI_CODIGO INT NOT NULL,
  GRU_NOME_PROJETO VARCHAR(150),
  GRU_MEDIA DOUBLE,
  GRU_FINALIZADO BOOL,
  FOREIGN KEY(PRI_CODIGO) REFERENCES PRI_PROJETO_INTER(PRI_CODIGO) ON UPDATE CASCADE ON DELETE NO ACTION
);

CREATE TABLE REQ_REQUERIMENTO(
  REQ_CODIGO INT PRIMARY KEY AUTO_INCREMENT,
  GRU_CODIGO INT NOT NULL,
  PRO_MATRICULA VARCHAR(20) NOT NULL,
  REQ_DESCRICAO TEXT,
  REQ_DT_REQUISICAO DATETIME,
  REQ_DT_INICIAL DATETIME,
  REQ_DT_FINAL DATETIME,
  REQ_RESOLVIDO BOOL,
  FOREIGN KEY(GRU_CODIGO) REFERENCES GRU_GRUPO(GRU_CODIGO) ON UPDATE CASCADE ON DELETE NO ACTION
);

CREATE TABLE GAL_GRUPO_ALUNO(
  ALU_MATRICULA VARCHAR(20) NOT NULL,
  GRU_CODIGO INT NOT NULL,
  PRIMARY KEY(ALU_MATRICULA, GRU_CODIGO),
  FOREIGN KEY(GRU_CODIGO) REFERENCES GRU_GRUPO(GRU_CODIGO) ON UPDATE CASCADE ON DELETE NO ACTION
);

CREATE TABLE CGE_CRITERIOS_GERAIS(
  CGE_CODIGO INT PRIMARY KEY,
  CGE_NOME VARCHAR(50),
  CGE_DESCRICAO VARCHAR(200),
  CGE_ATIVO BOOL
);

CREATE TABLE CPI_CRITERIO_PI(
  CPI_CODIGO INT PRIMARY KEY AUTO_INCREMENT,
  CGE_CODIGO INT NOT NULL,
  PRI_CODIGO INT NOT NULL,
  ADI_CODIGO INT NOT NULL,
  CPI_PESO INT NOT NULL,
  FOREIGN KEY(CGE_CODIGO) REFERENCES CGE_CRITERIOS_GERAIS(CGE_CODIGO) ON UPDATE CASCADE ON DELETE NO ACTION,
  FOREIGN KEY(PRI_CODIGO) REFERENCES API_ATRIBUICAO_PI(PRI_CODIGO) ON UPDATE CASCADE ON DELETE NO ACTION,
  FOREIGN KEY(ADI_CODIGO) REFERENCES API_ATRIBUICAO_PI(ADI_CODIGO) ON UPDATE CASCADE ON DELETE NO ACTION
);

CREATE TABLE HIS_HISTORICO_ALUNO_DISCIPLINA(
  HIS_CODIGO INT PRIMARY KEY AUTO_INCREMENT,
  ALU_MATRICULA VARCHAR(20) NOT NULL,
  CPI_CODIGO INT NOT NULL,
  HIS_NOTA DOUBLE,
  FOREIGN KEY(ALU_MATRICULA) REFERENCES GAL_GRUPO_ALUNO(ALU_MATRICULA) ON UPDATE CASCADE ON DELETE NO ACTION,
  FOREIGN KEY(CPI_CODIGO) REFERENCES CPI_CRITERIO_PI(CPI_CODIGO) ON UPDATE CASCADE ON DELETE NO ACTION
);